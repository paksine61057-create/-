<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ระบบติดตามงบประมาณ - โรงเรียนประจักษ์ศิลปาคม</title>
    
    <!-- 1. Styles & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- 2. React Core (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Libraries (Recharts & Lucide) -->
    <script src="https://unpkg.com/recharts@2.10.0/umd/Recharts.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- 4. Babel (To compile JSX in browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #F7F9FC; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c0a5f5; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6A4DE8; }
        
        /* Animations */
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        
        @keyframes scale-up { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .animate-scale-up { animation: scale-up 0.3s ease-out forwards; }
        
        @keyframes blob { 
            0% { transform: translate(0px, 0px) scale(1); } 
            33% { transform: translate(30px, -50px) scale(1.1); } 
            66% { transform: translate(-20px, 20px) scale(0.9); } 
            100% { transform: translate(0px, 0px) scale(1); } 
        }
        .animate-blob { animation: blob 7s infinite; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0",
    "recharts": "https://aistudiocdn.com/recharts@^3.4.1"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        // 1. INITIALIZATION & HELPERS
        // ==========================================
        const { useState, useEffect, useRef } = React;
        const { createRoot } = ReactDOM;
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, Legend } = window.Recharts;

        // Icon Helper Component
        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && window.lucide.icons && window.lucide.icons[name]) {
                    const svgString = window.lucide.icons[name].toSvg({ 
                        width: size, 
                        height: size, 
                        class: className 
                    });
                    if (iconRef.current) {
                        iconRef.current.innerHTML = svgString;
                    }
                }
            }, [name, size, className]);
            return <span ref={iconRef} className={`inline-flex items-center justify-center ${className}`}></span>;
        };

        // ==========================================
        // 2. CONSTANTS & DATA
        // ==========================================
        const THEME_GRADIENT = "bg-gradient-to-r from-[#6A4DE8] to-[#D76EF5]";
        const LOGO_URL = "https://img2.pic.in.th/pic/23847230_1753798167972527_6171827179803949950_o.md.png";
        
        // Enums replacement
        const Page = {
            HOME: 'HOME',
            RECORD: 'RECORD',
            DASHBOARD: 'DASHBOARD',
            PROJECTS: 'PROJECTS',
            REPORT: 'REPORT',
            ACCESS_LOGS: 'ACCESS_LOGS'
        };

        const MOCK_ACCESS_LOGS = [
            { id: 1, timestamp: '2025-10-01 08:30:00', username: 'admin', role: 'admin', status: 'Success' },
            { id: 2, timestamp: '2025-10-01 09:15:00', username: 'ชัชตะวัน', role: 'user', status: 'Success' },
            { id: 3, timestamp: '2025-10-02 10:00:00', username: 'ภราดร', role: 'user', status: 'Success' },
        ];

        const MOCK_PROJECTS = [
            { id: 101, name: "[PJ1-1] จัดซื้อวัสดุการจัดการเรียนการสอนทุกกลุ่มสาระ", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 50356, spent: 0, category: "งบอุดหนุน", status: "Active" },
            { id: 102, name: "[PJ1-2] โครงการค่าใช้จ่ายสาธารณูปโภค (ค่าไฟฟ้า ค่าอินเทอร์เน็ต)", group: "กลุ่มบริหารทั่วไป", owner: "ไม่ระบุ", budget: 283500, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 103, name: "[PJ1-3] โครงการจัดซื้อวัสดุ อุปกรณ์ เพื่อเพิ่มประสิทธิภาพการทำงานและสนับสนุนงาน", group: "กลุ่มบริหารงบประมาณ", owner: "ไม่ระบุ", budget: 22000, spent: 0, category: "งบลงทุน", status: "Active" },
            { id: 104, name: "[PJ1-4] โครงการจัดทำแผนปฏิบัติการประจำปี", group: "กลุ่มบริหารงบประมาณ", owner: "ไม่ระบุ", budget: 0, spent: 0, category: "งบดำเนินงาน", status: "Closed" },
            { id: 105, name: "[PJ1-5] โครงการส่งเสริมระเบียบวินัยในโรงเรียน", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 3000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 106, name: "[PJ1-6] โครงการจัดซื้อเวทีอเนกประสงค์เพื่อพัฒนาศักยภาพนักเรียนและสนับสนุนกิจกรรมโรงเรียน", group: "กลุ่มบริหารทั่วไป", owner: "ไม่ระบุ", budget: 0, spent: 0, category: "งบลงทุน", status: "Closed" },
            { id: 107, name: "[PJ1-7] โครงการจัดซื้ออุปกรณ์ถ่ายภาพ", group: "กลุ่มบริหารทั่วไป", owner: "ไม่ระบุ", budget: 6000, spent: 0, category: "งบลงทุน", status: "Active" },
            { id: 108, name: "[PJ1-8] โครงการประชุมกรรมการสถานศึกษา", group: "กลุ่มบริหารทั่วไป", owner: "ไม่ระบุ", budget: 5000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 109, name: "[PJ1-9] โครงการจัดหาสื่อและเทคโนโลยีสำหรับ ครู นักเรียนและบุคลากรทางการศึกษา", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 75000, spent: 0, category: "งบอุดหนุน", status: "Active" },
            { id: 110, name: "[PJ1-10] โครงการจัดซื้อยา และเวชภัณฑ์", group: "กลุ่มบริหารทั่วไป", owner: "ไม่ระบุ", budget: 4105, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 112, name: "[PJ1-12] โครงการรับนักเรียนปีการศึกษา 2569", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 5000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 113, name: "[PJ1-13] กิจกรรมวันสถาปนาโรงเรียน และบวงสรวงกรมหลวงประจักษ์", group: "กลุ่มบริหารทั่วไป", owner: "ไม่ระบุ", budget: 8000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 114, name: "[PJ1-14] โครงการปรับปรุงภูมิทัศน์ภายในโรงเรียนและปรับปรุงซ่อมแซมห้องเรียน ห้องปฏิบัติการ", group: "กลุ่มบริหารทั่วไป", owner: "ไม่ระบุ", budget: 20000, spent: 0, category: "งบลงทุน", status: "Active" },
            { id: 115, name: "[PJ1-15] โครงการเยี่ยมบ้านนักเรียน", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 18000, spent: 0, category: "งบเงินอุดหนุน", status: "Active" },
            { id: 116, name: "[PJ1-16] โครงการประชุมผู้ปกครองชั้นเรียน", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 7000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 117, name: "[PJ1-17] โครงการพัฒนาบุคลากร(ดูงาน)", group: "กลุ่มบริหารงานบุคคล", owner: "ไม่ระบุ", budget: 40000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 118, name: "[PJ1-18] โครงการพัฒนาครูต้นแบบ", group: "กลุ่มบริหารงานบุคคล", owner: "ไม่ระบุ", budget: 5356, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 119, name: "[PJ1-19] โครงการเสริมประสิทธิภาพการจัดการเรียนการสอน", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 314000, spent: 0, category: "งบอุดหนุน", status: "Active" },
            { id: 121, name: "[PJ1-21] โครงการปัจฉิมนิเทศ ม.3 และ ม.6", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 13000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 123, name: "[PJ1-23] โครงการพัฒนาโรงเรียนสุจริต", group: "กลุ่มบริหารทั่วไป", owner: "ไม่ระบุ", budget: 3000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 124, name: "[PJ1-24] โครงการแนะแนวเพื่อศึกษาต่อ (ม1,ม4)", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 10000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 128, name: "[PJ1-28] โครงการสวนพฤกษศาสตร์", group: "กลุ่มบริหารทั่วไป", owner: "ไม่ระบุ", budget: 3000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 129, name: "[PJ1-29] โครงการปฐมนิเทศนักเรียน", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 3500, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 131, name: "[PJ1-31] โครงการพัฒนาโรงเรียนด้วยเทคโนโลยีดิจิทัลและนวัตกรรมการศึกษา", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 11850, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 132, name: "[PJ1-32] โครงการ ห้องสมุดมีชีวิต", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 5000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 133, name: "[PJ1-33] โครงการจัดหาสื่อและเทคโนโลยีเพื่อพัฒนาคุณภาพผู้เรียน", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 20000, spent: 0, category: "งบอุดหนุน", status: "Active" },
            { id: 134, name: "[PJ1-34] โครงการสถานศึกษาปลอดบุหรี่", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 2000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 135, name: "[PJ1-35] โครงการสถานศึกษาสีขาว", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 3000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 136, name: "[PJ1-36] โครงการ TO BE NUMBER ONE", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 3000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 137, name: "[PJ1-37] โครงการส่งเสริมประชาธิปไตย", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 500, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 138, name: "[PJ1-38] โครงการกิจกรรมไหว้ครู", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 3000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 139, name: "[PJ1-39] โครงการวันเอดส์โลก", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 1000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 140, name: "[PJ1-40] โครงการโรงเรียนส่งเสริมความปลอดภัย", group: "กลุ่มบริหารทั่วไป", owner: "ไม่ระบุ", budget: 3000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 141, name: "[PJ1-41] โครงการยกระดับการส่งเสริมกิจกรรมทางกายเพื่อเด็กวัยเรียน วัยรุ่น สูง ดี สมส่วน แข็งแรง", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 5000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 142, name: "[PJ1-42] โครงการวันคริสมาสต์และสัปดาห์ Language Battle 2025 : ศึกชิงเจ้าภาษา", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 10000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 143, name: "[PJ1-43] โครงการวันสุนทรภู่สู่วันภาษาไทย", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 8000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 144, name: "[PJ1-44] โครงการจัดซื้อวัสดุกีฬา", group: "กลุ่มบริหารทั่วไป", owner: "ไม่ระบุ", budget: 5000, spent: 0, category: "งบลงทุน", status: "Active" },
            { id: 145, name: "[PJ1-45] โครงการจัดนิทรรศการโครงงานอาชีพ", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 5000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 146, name: "[PJ1-46] โครงการจัดหาสื่อและเทคโนโลยีเพื่อพัฒนาคุณภาพผู้เรียน", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 15000, spent: 0, category: "งบอุดหนุน", status: "Active" },
            { id: 147, name: "[PJ1-47] โครงการแข่งขันกีฬภายในโรงเรียนประจักษ์ศิลปาคม", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 22000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 149, name: "[PJ1-49] โครงการจัดซื้อวัสดุอุปกรณ์กีฬา", group: "กลุ่มบริหารทั่วไป", owner: "ไม่ระบุ", budget: 5000, spent: 0, category: "งบลงทุน", status: "Active" },
            { id: 151, name: "[PJ1-51] โครงการวันสำคัญทางพระพุทธศาสนา", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 8000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 153, name: "[PJ1-53] โครงการส่งเสริม พัฒนาศูนย์การเรียนรู้ตามหลักปรัชญาเศรษฐกิจพอเพียงฯ", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 30000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 154, name: "[PJ1-54] โครงการศึกษาแหล่งเรียนรู้ทางประวัติศาสตร์เมืองอุดรธานี", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 5000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 155, name: "[PJ1-55] โครงการวันแม่", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 5000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 156, name: "[PJ1-56] โครงการวันพ่อ", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 5000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 158, name: "[PJ1-58] โครงการพัฒนางานแนะแนว โรงเรียนประจักษ์ศิลปาคม", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 17000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 201, name: "[PJ2-1] โครงการอบรมพัฒนานักเรียนเพื่อนที่ปรึกษา YC : Youth counselor", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 20000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 202, name: "[PJ2-2] โครงการเข้าค่ายลูกเสือ-เนตรนารี สามัญรุ่นใหญ่", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 22000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 203, name: "[PJ2-3] โครงการยกระดับผลสัมฤทธิ์ทางการเรียนกลุ่มสาระวิทยาศาสตร์และเทคโนโลยี", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 5000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 204, name: "[PJ2-4] โครงการยกระดับผลสัมฤทธิ์ทางวิชาการ (ติว โอเนต ม.3,ม.6)", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 13400, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 205, name: "[PJ2-5] โครงการแข่งขันทักษะวิชาการ (งานศิลปหัตถกรรม)", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 30000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 206, name: "[PJ2-6] โครงการค่ายพัฒนาศักยภาพทางวิทยาศาสตร์และเทคโนโลยี", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 35000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 207, name: "[PJ2-7] โครงการ English and Chinese Camp", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 20000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 208, name: "[PJ2-8] โครงการทัศนศึกษาแหล่งเรียนรู้", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 70000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 209, name: "[PJ2-9] โครงการส่งเสริมความเป็นเลิศด้านดนตรีและนาฏศิลป์ สู่ศิลปินมืออาชีพ", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 40000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 210, name: "[PJ2-10] โครงการค่ายคณิตศาสตร์", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 11600, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 211, name: "[PJ2-11] โครงการค่ายพัฒนาคุณธรรม จริยธรรมนักเรียน", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 20000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 212, name: "[PJ2-12] โครงการค่ายปรับพื้นฐานคุณลักษณะอันพึงประสงค์", group: "กลุ่มกิจการนักเรียน", owner: "ไม่ระบุ", budget: 3000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 213, name: "[PJ2-13] โครงการส่งเสริมความปลอดภัย(ว่ายน้ำเพื่อชีวิต)", group: "กลุ่มบริหารทั่วไป", owner: "ไม่ระบุ", budget: 35000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 214, name: "[PJ2-14] โครงการรู้เท่าทันสื่อและเทคโนโลยี", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 2993, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 215, name: "[PJ2-15] โครงการส่งเสริมทักษะอาชีพ 'ตลาดนัดทองหลาง' สร้างโอกาส สร้างอนาคต", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 15000, spent: 0, category: "งบกิจกรรมพัฒนาผู้เรียน", status: "Active" },
            { id: 216, name: "[PJ2-16] โครงการพัฒนาการอ่านออกเขียนได้", group: "กลุ่มบริหารวิชาการ", owner: "ไม่ระบุ", budget: 1000, spent: 0, category: "งบดำเนินงาน", status: "Active" },
            { id: 301, name: "[PJ3-1] หักงบกลาง 10%", group: "กลุ่มบริหารงบประมาณ", owner: "ไม่ระบุ", budget: 72356, spent: 0, category: "งบกลาง", status: "Active" }
        ];
        
        const CHART_DATA_MONTHLY = [
            { name: 'ต.ค. 68', spending: 0 }, { name: 'พ.ย. 68', spending: 0 }, { name: 'ธ.ค. 68', spending: 0 },
            { name: 'ม.ค. 69', spending: 0 }, { name: 'ก.พ. 69', spending: 0 }, { name: 'มี.ค. 69', spending: 0 },
            { name: 'เม.ย. 69', spending: 0 }, { name: 'พ.ค. 69', spending: 0 }, { name: 'มิ.ย. 69', spending: 0 },
            { name: 'ก.ค. 69', spending: 0 }, { name: 'ส.ค. 69', spending: 0 }, { name: 'ก.ย. 69', spending: 0 },
        ];

        const CATEGORY_COLORS = ['#6A4DE8', '#D76EF5', '#FDBA74'];

        // ==========================================
        // 3. UI COMPONENTS
        // ==========================================
        
        const Card = ({ children, className = "", title, action }) => (
            <div className={`bg-white rounded-3xl shadow-lg p-6 ${className} transition-all duration-300 hover:shadow-xl`}>
                {(title || action) && (
                    <div className="flex justify-between items-center mb-4">
                        {title && <h3 className="text-xl font-bold text-gray-800">{title}</h3>}
                        {action && <div>{action}</div>}
                    </div>
                )}
                {children}
            </div>
        );

        const Login = ({ onLogin, onRecordLog }) => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            
            const handleLogin = (e) => {
                e.preventDefault();
                setError('');
                const cleanUsername = username.trim();
                const cleanPassword = password.trim();

                const AUTHORIZED_USERS = ["ชัชตะวัน", "ภราดร", "ภาคภูมิ", "ทิวาวรรณ", "วัชรี", "บุญญาภรณ์", "อัญชนีย์", "วลัยรัตน์", "บุญจันทร์", "ยุทธไกร", "กันต์ฤทัย", "เสาวภา", "อภิชาติ", "สุภาภรณ์", "วิษณุ", "จักรพงษ์", "บุญเสริม", "อุดมวิทย์", "พงษ์เพชร", "ชลฎา", "ปภัสพ์มณ", "ตรีนัทธ์ธนา", "วชิรวิทย์", "ศิรินภา"];

                if (cleanUsername === 'admin' && cleanPassword === 'admin4444') {
                    onRecordLog(cleanUsername, 'admin', 'Success');
                    onLogin('admin', 'ผู้ดูแลระบบ (Admin)');
                    return;
                }
                if (AUTHORIZED_USERS.includes(cleanUsername) && cleanPassword === 'PJ123') {
                    onRecordLog(cleanUsername, 'user', 'Success');
                    onLogin('user', `คุณ${cleanUsername}`);
                    return;
                }
                onRecordLog(cleanUsername, 'unknown', 'Failed');
                setError('ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง');
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-[#F7F9FC] p-4 font-sans relative overflow-hidden">
                     <div className="absolute top-0 left-0 w-full h-1/2 bg-gradient-to-b from-purple-100 to-transparent -z-10"></div>
                     <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-scale-up">
                        <div className={`${THEME_GRADIENT} p-8 text-center relative`}>
                            <div className="w-32 h-32 flex items-center justify-center mx-auto mb-4">
                               <img src={LOGO_URL} alt="Logo" className="w-full h-full object-contain drop-shadow-md" />
                            </div>
                            <h1 className="text-2xl font-bold text-white">Prajak Budget 2569</h1>
                            <p className="text-purple-100 text-sm mt-1">ระบบติดตามการใช้งบประมาณโรงเรียน</p>
                        </div>
                        <div className="p-8">
                            <form onSubmit={handleLogin} className="space-y-6">
                                {error && <div className="bg-red-50 text-red-600 text-sm p-3 rounded-xl flex items-center"><Icon name="AlertTriangle" size={16} className="mr-2" />{error}</div>}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1 ml-1">ชื่อผู้ใช้</label>
                                    <input type="text" value={username} onChange={(e) => setUsername(e.target.value)} className="block w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none" placeholder="ระบุชื่อผู้ใช้" required />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1 ml-1">รหัสผ่าน</label>
                                    <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="block w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none" placeholder="ระบุรหัสผ่าน" required />
                                </div>
                                <button type="submit" className={`w-full flex justify-center items-center gap-2 py-3 px-4 border border-transparent rounded-xl shadow-lg text-sm font-bold text-white ${THEME_GRADIENT} hover:opacity-90`}>
                                    <Icon name="LogIn" size={18} /> เข้าสู่ระบบ
                                </button>
                            </form>
                             <div className="mt-8 bg-gray-50 rounded-xl p-4 border border-gray-100">
                                <h4 className="text-sm font-bold text-gray-700 mb-2 flex items-center gap-2"><Icon name="AlertCircle" size={16} className="text-purple-500" /> คำแนะนำสำหรับผู้ใช้</h4>
                                <ul className="text-xs text-gray-500 space-y-1 ml-1">
                                    <li>• <strong>ชื่อผู้ใช้:</strong> ใช้ชื่อจริงภาษาไทย (เช่น ชัชตะวัน)</li>
                                    <li>• <strong>รหัสผ่าน:</strong> PJ123</li>
                                </ul>
                             </div>
                        </div>
                     </div>
                </div>
            );
        };

        const RecordExpense = ({ projects }) => {
            const [submitted, setSubmitted] = useState(false);
            const [formData, setFormData] = useState({ projectId: '', item: '', date: new Date().toISOString().split('T')[0], amount: '', note: '' });
            const handleChange = (e) => setFormData(prev => ({ ...prev, [e.target.name]: e.target.value }));
            const handleSubmit = (e) => {
                e.preventDefault();
                setTimeout(() => { setSubmitted(true); setTimeout(() => setSubmitted(false), 3000); setFormData({ projectId: '', item: '', date: new Date().toISOString().split('T')[0], amount: '', note: '' }); }, 800);
            };
            return (
                <div className="max-w-2xl mx-auto animate-fade-in">
                    <div className="flex items-center mb-6"><div className={`p-2 rounded-lg ${THEME_GRADIENT} text-white mr-3`}><Icon name="Save" size={24} /></div><h2 className="text-2xl font-bold text-gray-800">บันทึกรายการใช้จ่าย</h2></div>
                    <Card>
                        {submitted && <div className="mb-6 bg-green-50 border border-green-200 text-green-800 rounded-xl p-4 flex items-center"><Icon name="CheckCircle" className="mr-2 h-5 w-5 text-green-600" />บันทึกข้อมูลสำเร็จ!</div>}
                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">เลือกโครงการ</label><select name="projectId" value={formData.projectId} onChange={handleChange} required className="block w-full pl-4 pr-10 py-3 text-base border border-gray-300 rounded-xl outline-none"><option value="">-- กรุณาเลือกโครงการ --</option>{projects.filter(p => p.status !== 'Closed').map(p => (<option key={p.id} value={p.id}>{p.name}</option>))}</select></div>
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">รายการใช้จ่าย</label><input type="text" name="item" value={formData.item} onChange={handleChange} required placeholder="เช่น ค่าวัสดุสำนักงาน" className="block w-full px-4 py-3 border border-gray-300 rounded-xl outline-none" /></div>
                            <div className="grid grid-cols-2 gap-6">
                                <div><label className="block text-sm font-medium text-gray-700 mb-1">วันที่</label><input type="date" name="date" value={formData.date} onChange={handleChange} required className="block w-full px-4 py-3 border border-gray-300 rounded-xl outline-none" /></div>
                                <div><label className="block text-sm font-medium text-gray-700 mb-1">จำนวนเงิน (บาท)</label><input type="number" name="amount" value={formData.amount} onChange={handleChange} required placeholder="0.00" className="block w-full px-4 py-3 border border-gray-300 rounded-xl outline-none" /></div>
                            </div>
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">หมายเหตุ</label><textarea name="note" value={formData.note} onChange={handleChange} rows={3} className="block w-full px-4 py-3 border border-gray-300 rounded-xl outline-none" /></div>
                            <button type="submit" className={`w-full py-3 rounded-2xl text-white font-bold ${THEME_GRADIENT} shadow-md hover:opacity-90`}>บันทึกข้อมูล</button>
                        </form>
                    </Card>
                </div>
            );
        };

        const ProjectManager = ({ projects, onUpdate, onAdd, onDelete }) => {
            const [showModal, setShowModal] = useState(false);
            const [editingProject, setEditingProject] = useState(null);
            const [formData, setFormData] = useState({ name: '', group: 'กลุ่มบริหารวิชาการ', owner: '', budget: 0, category: 'งบดำเนินงาน', status: 'Active', spent: 0 });

            useEffect(() => {
                if (editingProject) setFormData(editingProject);
                else setFormData({ name: '', group: 'กลุ่มบริหารวิชาการ', owner: '', budget: 0, category: 'งบดำเนินงาน', status: 'Active', spent: 0 });
            }, [editingProject, showModal]);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (editingProject) onUpdate({ ...editingProject, ...formData });
                else onAdd({ ...formData, id: Math.max(...projects.map(p => p.id)) + 1 });
                setShowModal(false);
            };

            const handleChange = (e) => setFormData(prev => ({ ...prev, [e.target.name]: e.target.name === 'budget' ? Number(e.target.value) : e.target.value }));

            return (
                <div className="animate-fade-in relative">
                    <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold text-gray-800">จัดการโครงการ</h2><button onClick={() => {setEditingProject(null); setShowModal(true);}} className={`${THEME_GRADIENT} text-white px-4 py-2 rounded-xl shadow-md flex items-center gap-2`}><Icon name="Plus" size={20} /> เพิ่มโครงการใหม่</button></div>
                    <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                        {projects.map(project => (
                            <div key={project.id} className="bg-white rounded-3xl p-6 shadow-md hover:shadow-xl transition-all border border-gray-100 relative">
                                <div className="absolute top-6 right-6 text-gray-400"><Icon name="MoreVertical" size={20} /></div>
                                <div className="mb-4"><span className={`text-xs font-bold px-2 py-1 rounded-lg ${project.category.includes('ลงทุน') ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'}`}>{project.category}</span></div>
                                <h3 className="text-lg font-bold text-gray-800 mb-1 line-clamp-2 h-14">{project.name}</h3>
                                <p className="text-sm text-gray-500 mb-4">{project.group}</p>
                                <div className="space-y-3">
                                    <div className="flex justify-between text-sm"><span className="text-gray-500">งบประมาณ:</span><span className="font-bold text-gray-800">{project.budget.toLocaleString()} บ.</span></div>
                                    <div className="w-full bg-gray-100 rounded-full h-2"><div className={`h-2 rounded-full ${THEME_GRADIENT}`} style={{ width: `${project.budget > 0 ? (project.spent / project.budget) * 100 : 0}%` }}></div></div>
                                </div>
                                <div className="mt-6 flex gap-2 border-t pt-4">
                                    <button onClick={() => {setEditingProject(project); setShowModal(true);}} className="flex-1 flex items-center justify-center gap-2 py-2 rounded-xl text-sm font-medium text-gray-600 hover:bg-gray-50 border border-gray-200"><Icon name="Edit" size={16} /> แก้ไข</button>
                                    <button onClick={() => {if(window.confirm('ยืนยันการลบ?')) onDelete(project.id);}} className="flex-1 flex items-center justify-center gap-2 py-2 rounded-xl text-sm font-medium text-red-500 hover:bg-red-50 border border-red-100"><Icon name="Trash2" size={16} /> ลบ</button>
                                </div>
                            </div>
                        ))}
                    </div>
                    {showModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
                            <div className="bg-white rounded-3xl shadow-2xl w-full max-w-lg p-6 relative animate-scale-up overflow-y-auto max-h-[90vh]">
                                <button onClick={() => setShowModal(false)} className="absolute top-4 right-4 text-gray-400"><Icon name="X" size={24} /></button>
                                <h3 className="text-2xl font-bold text-gray-800 mb-6">{editingProject ? 'แก้ไขโครงการ' : 'เพิ่มโครงการใหม่'}</h3>
                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <div><label className="text-sm font-medium">ชื่อโครงการ</label><input type="text" name="name" value={formData.name} onChange={handleChange} required className="w-full border p-2 rounded-xl" /></div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="text-sm font-medium">งบประมาณ</label><input type="number" name="budget" value={formData.budget} onChange={handleChange} required className="w-full border p-2 rounded-xl" /></div>
                                        <div><label className="text-sm font-medium">กลุ่มงาน</label><select name="group" value={formData.group} onChange={handleChange} className="w-full border p-2 rounded-xl"><option value="กลุ่มบริหารวิชาการ">วิชาการ</option><option value="กลุ่มบริหารงบประมาณ">งบประมาณ</option><option value="กลุ่มบริหารงานบุคคล">บุคคล</option><option value="กลุ่มบริหารทั่วไป">ทั่วไป</option><option value="กลุ่มกิจการนักเรียน">กิจการ นร.</option></select></div>
                                    </div>
                                    <button type="submit" className={`w-full py-3 rounded-2xl text-white font-bold ${THEME_GRADIENT}`}>{editingProject ? 'บันทึกแก้ไข' : 'สร้างโครงการ'}</button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const ReportExport = ({ projects }) => {
            const [selectedProject, setSelectedProject] = useState('all');
            const [isGenerating, setIsGenerating] = useState(false);
            const handleGenerate = () => { setIsGenerating(true); setTimeout(() => setIsGenerating(false), 1500); };
            const reportData = selectedProject === 'all' ? projects.filter(p => p.spent > 0) : projects.filter(p => p.id === Number(selectedProject));
            const totalBudget = projects.reduce((sum, p) => sum + p.budget, 0);
            const totalSpent = projects.reduce((sum, p) => sum + p.spent, 0);

            return (
                <div className="max-w-5xl mx-auto animate-fade-in">
                   <h2 className="text-2xl font-bold text-gray-800 mb-6">ออกรายงานสรุป</h2>
                    <div className="grid grid-cols-1 md:grid-cols-12 gap-6">
                        <div className="md:col-span-4 space-y-6">
                            <Card>
                                <h3 className="font-bold text-gray-700 mb-4 flex items-center gap-2"><Icon name="Calendar" size={18} className="text-purple-500" /> ตัวเลือกรายงาน</h3>
                                <select className="w-full p-2 border rounded-lg mb-2"><option>สรุปการเบิกจ่ายงบประมาณ</option></select>
                                <select className="w-full p-2 border rounded-lg mb-2" value={selectedProject} onChange={(e) => setSelectedProject(e.target.value)}><option value="all">-- โครงการที่มีการเบิกจ่าย --</option>{projects.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}</select>
                                <button onClick={handleGenerate} className={`w-full py-2 rounded-xl text-white font-bold ${THEME_GRADIENT}`}>{isGenerating ? 'Generating...' : 'ดูตัวอย่าง'}</button>
                            </Card>
                            <div className="bg-purple-50 p-4 rounded-2xl border border-purple-100 text-center"><Icon name="FileText" size={40} className="mx-auto text-purple-400 mb-2" /><button className="w-full py-2 bg-white border border-purple-200 text-purple-600 rounded-lg font-bold"><Icon name="Download" size={16} className="inline mr-2"/>Download PDF</button></div>
                        </div>
                        <div className="md:col-span-8">
                            <Card className="min-h-[600px] flex flex-col relative bg-gray-500/5">
                                <div className="flex-grow border border-gray-200 p-8 bg-white shadow-lg mx-auto w-full max-w-[210mm] text-black">
                                    <div className="text-center mb-6 border-b-2 border-gray-800 pb-4"><h1 className="text-xl font-bold">รายงานสรุปการเบิกจ่ายงบประมาณ</h1><h2 className="text-lg">โรงเรียนประจักษ์ศิลปาคม</h2></div>
                                    {isGenerating ? <div className="text-center p-10">กำลังประมวลผล...</div> : (
                                        <div className="space-y-6">
                                            <div className="flex justify-between text-sm"><p><strong>ผู้พิมพ์:</strong> นางสาวปภัสพ์มณ ทองอาสา</p><p>วันที่: {new Date().toLocaleDateString('th-TH')}</p></div>
                                            <div className="bg-gray-50 p-4 rounded mb-4 grid grid-cols-3 text-center"><div><p className="text-xs text-gray-500">งบทั้งหมด</p><p className="font-bold">{totalBudget.toLocaleString()}</p></div><div><p className="text-xs text-gray-500">ใช้ไป</p><p className="font-bold text-purple-600">{totalSpent.toLocaleString()}</p></div><div><p className="text-xs text-gray-500">คงเหลือ</p><p className="font-bold text-green-600">{(totalBudget - totalSpent).toLocaleString()}</p></div></div>
                                            <table className="w-full text-sm border-collapse"><thead><tr className="bg-gray-100"><th className="text-left p-2">โครงการ</th><th className="text-right p-2">งบอนุมัติ</th><th className="text-right p-2">เบิกจ่าย</th><th className="text-right p-2">คงเหลือ</th></tr></thead><tbody>{reportData.length > 0 ? reportData.map((p, i) => (<tr key={i} className="border-b"><td className="p-2">{p.name}</td><td className="text-right p-2">{p.budget.toLocaleString()}</td><td className="text-right p-2">{p.spent.toLocaleString()}</td><td className="text-right p-2">{(p.budget - p.spent).toLocaleString()}</td></tr>)) : <tr><td colSpan={4} className="text-center p-4">ไม่มีรายการ</td></tr>}</tbody></table>
                                            <div className="mt-16 flex justify-between text-center px-4"><div className="w-5/12"><div className="border-b border-dotted border-gray-400 mb-2 h-8"></div><p className="text-sm">หัวหน้างานนโยบายและแผน</p></div><div className="w-5/12"><div className="border-b border-dotted border-gray-400 mb-2 h-8"></div><p className="text-sm">ผู้อำนวยการโรงเรียน</p></div></div>
                                        </div>
                                    )}
                                </div>
                            </Card>
                        </div>
                    </div>
                </div>
            );
        };

        const AccessLogs = ({ logs }) => {
            const sortedLogs = [...logs].sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());
            return (
                <div className="space-y-6 animate-fade-in">
                    <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2"><Icon name="Clock" className="text-purple-600" /> ประวัติการเข้าใช้งานระบบ</h2>
                    <Card className="overflow-hidden">
                        <table className="min-w-full divide-y divide-gray-200"><thead className="bg-gray-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500">เวลา</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500">ผู้ใช้งาน</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500">สถานะ</th></tr></thead><tbody className="bg-white divide-y divide-gray-200">{sortedLogs.map(log => (<tr key={log.id}><td className="px-6 py-4 text-sm text-gray-500">{new Date(log.timestamp).toLocaleString('th-TH')}</td><td className="px-6 py-4 text-sm font-medium">{log.username} ({log.role})</td><td className="px-6 py-4 text-center">{log.status === 'Success' ? <span className="text-green-600 text-sm"><Icon name="CheckCircle" size={16} className="inline"/> สำเร็จ</span> : <span className="text-red-600 text-sm">ล้มเหลว</span>}</td></tr>))}</tbody></table>
                    </Card>
                </div>
            );
        };

        const Home = ({ setPage, projects, username, userRole }) => {
            const totalBudget = projects.reduce((acc, curr) => acc + curr.budget, 0);
            const totalSpent = projects.reduce((acc, curr) => acc + curr.spent, 0);
            const remaining = totalBudget - totalSpent;
            const percentage = totalBudget > 0 ? (totalSpent / totalBudget) * 100 : 0;
            const formatThaiCurrency = (amount) => new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB' }).format(amount);

            const pieChartData = projects.reduce((acc, project) => {
                let category = 'งบอุดหนุนรายหัว (PJ1)'; 
                if (project.id >= 300) category = 'งบกลาง (PJ3)';
                else if (project.id >= 200) category = 'งบพัฒนาผู้เรียน (PJ2)';
                const existing = acc.find(item => item.name === category);
                if (existing) existing.value += project.budget;
                else acc.push({ name: category, value: project.budget });
                return acc;
            }, []);
            const order = ['งบอุดหนุนรายหัว (PJ1)', 'งบพัฒนาผู้เรียน (PJ2)', 'งบกลาง (PJ3)'];
            pieChartData.sort((a, b) => order.indexOf(a.name) - order.indexOf(b.name));
            
            return (
                <div className="space-y-8 animate-fade-in">
                    <div className="flex flex-col md:flex-row justify-between items-center mb-6">
                        <div><h2 className="text-3xl font-bold text-gray-800">ยินดีต้อนรับ, {username}</h2><p className="text-gray-500 mt-1">ภาพรวมงบประมาณ โรงเรียนประจักษ์ศิลปาคม ปี 2569</p></div>
                        <div className="mt-4 md:mt-0"><span className="px-4 py-2 bg-white rounded-full shadow text-sm text-gray-600 font-medium">📅 วันนี้: {new Date().toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric'})}</span></div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <Card className="bg-gradient-to-br from-white to-gray-50 border-l-8 border-[#6A4DE8]">
                            <div className="flex items-center justify-between"><div><p className="text-gray-500 text-sm font-medium">งบประมาณได้รับจัดสรร</p><h3 className="text-2xl lg:text-3xl font-bold text-gray-800 mt-2">{formatThaiCurrency(totalBudget)}</h3></div><div className="p-3 bg-purple-100 rounded-2xl"><Icon name="Wallet" className="w-8 h-8 text-[#6A4DE8]" /></div></div>
                        </Card>
                        <Card className="bg-gradient-to-br from-white to-gray-50 border-l-8 border-[#D76EF5]">
                            <div className="flex items-center justify-between"><div><p className="text-gray-500 text-sm font-medium">เบิกจ่ายไปแล้ว</p><h3 className="text-2xl lg:text-3xl font-bold text-[#D76EF5] mt-2">{formatThaiCurrency(totalSpent)}</h3><p className="text-xs text-gray-400 mt-1">คิดเป็น {percentage.toFixed(1)}%</p></div><div className="p-3 bg-pink-100 rounded-2xl"><Icon name="TrendingUp" className="w-8 h-8 text-[#D76EF5]" /></div></div>
                        </Card>
                        <Card className="bg-gradient-to-br from-white to-gray-50 border-l-8 border-green-400">
                            <div className="flex items-center justify-between"><div><p className="text-gray-500 text-sm font-medium">คงเหลือสุทธิ</p><h3 className="text-2xl lg:text-3xl font-bold text-green-600 mt-2">{formatThaiCurrency(remaining)}</h3></div><div className="p-3 bg-green-100 rounded-2xl"><Icon name="AlertCircle" className="w-8 h-8 text-green-500" /></div></div>
                        </Card>
                    </div>
                    <div>
                        <h3 className="text-xl font-bold text-gray-800 mb-4">เมนูด่วน</h3>
                        <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                            {userRole === 'admin' && <button onClick={() => setPage(Page.RECORD)} className="group bg-white p-6 rounded-3xl shadow-md hover:shadow-xl transition-all duration-300 border border-transparent hover:border-purple-200 text-center flex flex-col items-center justify-center gap-3"><div className={`p-4 rounded-full ${THEME_GRADIENT} text-white shadow-md group-hover:scale-110 transition-transform`}><Icon name="FilePlus2" size={32} /></div><span className="font-semibold text-gray-700">บันทึกค่าใช้จ่าย</span></button>}
                            <button onClick={() => setPage(Page.DASHBOARD)} className="group bg-white p-6 rounded-3xl shadow-md hover:shadow-xl transition-all duration-300 border border-transparent hover:border-purple-200 text-center flex flex-col items-center justify-center gap-3"><div className={`p-4 rounded-full ${THEME_GRADIENT} text-white shadow-md group-hover:scale-110 transition-transform`}><Icon name="PieChart" size={32} /></div><span className="font-semibold text-gray-700">สรุปงบประมาณ</span></button>
                            {userRole === 'admin' && <button onClick={() => setPage(Page.PROJECTS)} className="group bg-white p-6 rounded-3xl shadow-md hover:shadow-xl transition-all duration-300 border border-transparent hover:border-purple-200 text-center flex flex-col items-center justify-center gap-3"><div className={`p-4 rounded-full ${THEME_GRADIENT} text-white shadow-md group-hover:scale-110 transition-transform`}><Icon name="FolderCog" size={32} /></div><span className="font-semibold text-gray-700">จัดการโครงการ</span></button>}
                            {userRole === 'admin' && <button onClick={() => setPage(Page.REPORT)} className="group bg-white p-6 rounded-3xl shadow-md hover:shadow-xl transition-all duration-300 border border-transparent hover:border-purple-200 text-center flex flex-col items-center justify-center gap-3"><div className={`p-4 rounded-full ${THEME_GRADIENT} text-white shadow-md group-hover:scale-110 transition-transform`}><Icon name="FileText" size={32} /></div><span className="font-semibold text-gray-700">ออกรายงาน</span></button>}
                            {userRole === 'admin' && <button onClick={() => setPage(Page.ACCESS_LOGS)} className="group bg-white p-6 rounded-3xl shadow-md hover:shadow-xl transition-all duration-300 border border-transparent hover:border-purple-200 text-center flex flex-col items-center justify-center gap-3"><div className={`p-4 rounded-full ${THEME_GRADIENT} text-white shadow-md group-hover:scale-110 transition-transform`}><Icon name="Clock" size={32} /></div><span className="font-semibold text-gray-700">ประวัติการเข้าใช้งาน</span></button>}
                        </div>
                    </div>
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <Card title="การเบิกจ่ายรายเดือน (ตัวอย่าง)">
                            <div className="h-64 w-full">
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart data={CHART_DATA_MONTHLY}>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#eee" />
                                        <XAxis dataKey="name" axisLine={false} tickLine={false} />
                                        <YAxis axisLine={false} tickLine={false} />
                                        <Tooltip cursor={{fill: '#f3f4f6'}} contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }} />
                                        <Bar dataKey="spending" fill="#6A4DE8" radius={[4, 4, 0, 0]} />
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        </Card>
                        <Card title="สัดส่วนงบประมาณตามกลุ่มโครงการ">
                            <div className="h-64 w-full flex justify-center items-center">
                                <ResponsiveContainer width="100%" height="100%">
                                    <PieChart>
                                        <Pie data={pieChartData} cx="50%" cy="50%" innerRadius={60} outerRadius={80} paddingAngle={5} dataKey="value">
                                            {pieChartData.map((entry, index) => (<Cell key={`cell-${index}`} fill={CATEGORY_COLORS[index % CATEGORY_COLORS.length]} />))}
                                        </Pie>
                                        <Tooltip contentStyle={{ borderRadius: '12px' }} formatter={(value) => formatThaiCurrency(value)} />
                                        <Legend iconType="circle" layout="vertical" verticalAlign="middle" align="right" wrapperStyle={{ fontSize: '12px' }} />
                                    </PieChart>
                                </ResponsiveContainer>
                            </div>
                        </Card>
                    </div>
                </div>
            );
        };

        const BudgetDashboard = ({ projects }) => {
            const [filterGroup, setFilterGroup] = useState('all');
            const getStats = (projs) => {
                const budget = projs.reduce((sum, p) => sum + p.budget, 0);
                const spent = projs.reduce((sum, p) => sum + p.spent, 0);
                const remaining = budget - spent;
                const percent = budget > 0 ? (spent / budget) * 100 : 0;
                return { budget, spent, remaining, percent };
            };
            const totalStats = getStats(projects);
            const pj1Stats = getStats(projects.filter(p => p.id >= 100 && p.id < 200));
            const pj2Stats = getStats(projects.filter(p => p.id >= 200 && p.id < 300));
            const pj3Stats = getStats(projects.filter(p => p.id >= 300));
            const overallChartData = [{ name: 'Used', value: totalStats.spent }, { name: 'Remaining', value: totalStats.remaining }];
            const filteredProjects = filterGroup === 'all' ? projects : projects.filter(p => p.group === filterGroup);
            const criticalProjects = projects.filter(p => p.budget > 0 && (p.spent / p.budget) > 0.8 && p.status !== 'Closed');

            const CategoryCard = ({ title, stats, color, iconName }) => (
                <div className="bg-white p-6 rounded-3xl shadow-md hover:shadow-xl transition-all border border-gray-100 flex flex-col justify-between h-full">
                    <div className="flex justify-between items-start mb-2">
                        <div className={`p-3 rounded-2xl bg-opacity-10 text-white`} style={{ backgroundColor: `${color}20` }}>
                             <Icon name={iconName} className={`text-[${color}]`} size={24} />
                        </div>
                        <span className="text-3xl font-bold" style={{ color: color }}>{stats.percent.toFixed(1)}%</span>
                    </div>
                    <div>
                        <h4 className="text-gray-600 font-bold text-sm mb-2">{title}</h4>
                        <div className="flex items-end justify-between mb-2"><div className="flex flex-col"><span className="text-xs text-gray-400">คงเหลือ</span><span className="text-lg font-bold text-gray-800">{stats.remaining.toLocaleString()}</span></div><div className="text-right"><span className="text-xs text-gray-400 block">งบประมาณ</span><span className="text-xs font-medium text-gray-600">{stats.budget.toLocaleString()}</span></div></div>
                        <div className="w-full bg-gray-100 rounded-full h-3 overflow-hidden"><div className="h-full rounded-full transition-all duration-1000 ease-out" style={{ width: `${stats.percent}%`, backgroundColor: color }}></div></div>
                    </div>
                </div>
            );

            return (
                <div className="space-y-8 animate-fade-in">
                    <div className="space-y-6">
                        <div className="bg-white rounded-3xl shadow-lg p-8 relative overflow-hidden flex flex-col md:flex-row items-center gap-8">
                            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 to-pink-500"></div>
                            <div className="flex-1 text-center md:text-left z-10">
                                <h2 className="text-3xl font-bold text-gray-800 mb-2">ภาพรวมการเบิกจ่ายงบประมาณ</h2>
                                <p className="text-gray-500 mb-6">สรุปสถานะงบประมาณรวมทุกหมวด (PJ1, PJ2, PJ3) ปี 2569</p>
                                <div className="flex gap-4 justify-center md:justify-start">
                                    <div className="bg-purple-50 px-6 py-3 rounded-2xl border border-purple-100"><p className="text-xs text-purple-600 font-bold uppercase tracking-wider">งบประมาณรวม</p><p className="text-2xl font-bold text-gray-800">{totalStats.budget.toLocaleString()}</p></div>
                                    <div className="bg-green-50 px-6 py-3 rounded-2xl border border-green-100"><p className="text-xs text-green-600 font-bold uppercase tracking-wider">คงเหลือสุทธิ</p><p className="text-2xl font-bold text-green-600">{totalStats.remaining.toLocaleString()}</p></div>
                                </div>
                            </div>
                            <div className="relative w-64 h-64 flex-shrink-0">
                                <ResponsiveContainer width="100%" height="100%"><PieChart><Pie data={overallChartData} innerRadius={80} outerRadius={100} startAngle={90} endAngle={-270} dataKey="value" stroke="none"><Cell fill="#6A4DE8" /><Cell fill="#F3F4F6" /></Pie></PieChart></ResponsiveContainer>
                                <div className="absolute inset-0 flex flex-col items-center justify-center"><span className="text-5xl font-bold text-[#6A4DE8]">{totalStats.percent.toFixed(1)}%</span><span className="text-sm text-gray-400 uppercase font-medium mt-1">ใช้ไปแล้ว</span></div>
                            </div>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <CategoryCard title="PJ1: งบอุดหนุนรายหัว" stats={pj1Stats} color="#8B5CF6" iconName="Wallet" />
                            <CategoryCard title="PJ2: งบพัฒนาผู้เรียน" stats={pj2Stats} color="#EC4899" iconName="TrendingUp" />
                            <CategoryCard title="PJ3: งบกลาง" stats={pj3Stats} color="#F59E0B" iconName="PieChart" />
                        </div>
                    </div>
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center pt-4 border-t border-gray-200">
                        <div><h2 className="text-2xl font-bold text-gray-800">รายละเอียดรายโครงการ</h2><p className="text-sm text-gray-500 mt-1">แสดงข้อมูล {filteredProjects.length} โครงการ</p></div>
                        <div className="mt-4 md:mt-0 flex items-center space-x-2 bg-white p-2 rounded-xl shadow-sm border border-gray-100">
                            <Icon name="Filter" size={18} className="text-purple-500 ml-2" />
                            <select className="bg-transparent border-none text-sm focus:ring-0 text-gray-700 font-medium cursor-pointer outline-none pr-8" value={filterGroup} onChange={(e) => setFilterGroup(e.target.value)}>
                                <option value="all">ทุกกลุ่มงาน</option><option value="กลุ่มบริหารวิชาการ">กลุ่มบริหารวิชาการ</option><option value="กลุ่มบริหารงบประมาณ">กลุ่มบริหารงบประมาณ</option><option value="กลุ่มกิจการนักเรียน">กลุ่มกิจการนักเรียน</option><option value="กลุ่มบริหารทั่วไป">กลุ่มบริหารทั่วไป</option><option value="กลุ่มบริหารงานบุคคล">กลุ่มบริหารงานบุคคล</option>
                            </select>
                        </div>
                    </div>
                    {criticalProjects.length > 0 && (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {criticalProjects.map(p => (
                                <div key={p.id} className="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-xl flex items-start shadow-sm animate-pulse"><Icon name="AlertTriangle" className="text-red-500 mr-3 flex-shrink-0" /><div><h4 className="font-bold text-red-700 text-sm">งบใกล้หมด: {p.name}</h4><p className="text-red-600 text-xs mt-1">ใช้จ่ายไปแล้ว {((p.spent / p.budget) * 100).toFixed(1)}% (เหลือ {p.budget - p.spent} บาท)</p></div></div>
                            ))}
                        </div>
                    )}
                    <Card className="overflow-hidden mt-4">
                        <div className="overflow-x-auto">
                            <table className="min-w-full divide-y divide-gray-200">
                                <thead className="bg-gray-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ชื่อโครงการ</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">กลุ่มงาน</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">งบได้รับ</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ใช้ไป</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">คงเหลือ</th><th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">สถานะ</th></tr></thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {filteredProjects.map((project) => (
                                        <tr key={project.id} className="hover:bg-gray-50 transition-colors"><td className="px-6 py-4"><div className="text-sm font-medium text-gray-900 line-clamp-1">{project.name}</div></td><td className="px-6 py-4 whitespace-nowrap"><span className="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800">{project.group}</span></td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium">{project.budget.toLocaleString()}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">{project.spent.toLocaleString()}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-green-600 text-right font-bold">{(project.budget - project.spent).toLocaleString()}</td><td className="px-6 py-4 whitespace-nowrap text-center">{project.status === 'Active' ? <div className="w-2 h-2 bg-green-500 rounded-full mx-auto"></div> : <div className="w-2 h-2 bg-gray-300 rounded-full mx-auto"></div>}</td></tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </Card>
                </div>
            );
        };

        const App = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [userRole, setUserRole] = useState(null);
            const [currentUser, setCurrentUser] = useState('');
            const [currentPage, setCurrentPage] = useState(Page.HOME);
            const [projects, setProjects] = useState(MOCK_PROJECTS);
            const [accessLogs, setAccessLogs] = useState(MOCK_ACCESS_LOGS);

            const handleLogin = (role, name) => { setIsAuthenticated(true); setUserRole(role); setCurrentUser(name); };
            const handleRecordLog = (username, role, status) => { setAccessLogs(prev => [{ id: accessLogs.length + 1, timestamp: new Date().toISOString(), username, role, status }, ...prev]); };
            const handleLogout = () => { setIsAuthenticated(false); setUserRole(null); setCurrentUser(''); setCurrentPage(Page.HOME); };
            const handleNavClick = (page) => { setCurrentPage(page); window.scrollTo(0, 0); };

            const allNavItems = [
                { page: Page.HOME, label: 'หน้าแรก', iconName: 'LayoutDashboard' },
                { page: Page.RECORD, label: 'บันทึกค่าใช้จ่าย', iconName: 'PlusCircle' },
                { page: Page.DASHBOARD, label: 'สรุปงบประมาณ', iconName: 'PieChart' },
                { page: Page.PROJECTS, label: 'จัดการโครงการ', iconName: 'FolderOpen' },
                { page: Page.REPORT, label: 'ออกรายงาน', iconName: 'FileText' },
                { page: Page.ACCESS_LOGS, label: 'ประวัติการใช้งาน', iconName: 'Clock' },
            ];

            const navItems = userRole === 'user' ? allNavItems.filter(item => [Page.HOME, Page.DASHBOARD].includes(item.page)) : allNavItems;
            const getPageTitle = () => navItems.find(i => i.page === currentPage)?.label || 'หน้าแรก';

            const renderContent = () => {
                switch (currentPage) {
                    case Page.HOME: return <Home setPage={handleNavClick} projects={projects} username={currentUser} userRole={userRole} />;
                    case Page.RECORD: return userRole === 'admin' ? <RecordExpense projects={projects} /> : <Home setPage={handleNavClick} projects={projects} username={currentUser} userRole={userRole} />;
                    case Page.DASHBOARD: return <BudgetDashboard projects={projects} />;
                    case Page.PROJECTS: return userRole === 'admin' ? <ProjectManager projects={projects} onUpdate={(u)=>setProjects(p=>p.map(x=>x.id===u.id?u:x))} onAdd={(n)=>setProjects(p=>[...p,n])} onDelete={(d)=>setProjects(p=>p.filter(x=>x.id!==d))} /> : <Home setPage={handleNavClick} projects={projects} username={currentUser} userRole={userRole} />;
                    case Page.REPORT: return userRole === 'admin' ? <ReportExport projects={projects} /> : <Home setPage={handleNavClick} projects={projects} username={currentUser} userRole={userRole} />;
                    case Page.ACCESS_LOGS: return userRole === 'admin' ? <AccessLogs logs={accessLogs} /> : <Home setPage={handleNavClick} projects={projects} username={currentUser} userRole={userRole} />;
                    default: return <Home setPage={handleNavClick} projects={projects} username={currentUser} userRole={userRole} />;
                }
            };

            if (!isAuthenticated) return <Login onLogin={handleLogin} onRecordLog={handleRecordLog} />;

            return (
                <div className="flex h-screen bg-[#F7F9FC] font-sans overflow-hidden">
                    <aside className="flex w-72 bg-white border-r border-gray-200 flex-col shadow-xl z-20 flex-shrink-0">
                        <div className="h-24 flex items-center gap-3 px-6 border-b border-gray-100"><img src={LOGO_URL} alt="Logo" className="w-12 h-12 object-contain" /><div><h1 className="font-bold text-lg text-gray-800 leading-tight">Prajak Budget</h1><span className="text-xs text-purple-600 font-bold tracking-wider">ปีงบประมาณ 2569</span></div></div>
                        <nav className="flex-1 overflow-y-auto p-4 space-y-1">
                            {navItems.map(item => (
                                <button key={item.page} onClick={() => handleNavClick(item.page)} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200 ${currentPage === item.page ? `${THEME_GRADIENT} text-white shadow-lg shadow-purple-200` : 'text-gray-500 hover:bg-purple-50 hover:text-purple-600'}`}>
                                    <Icon name={item.iconName} size={20} /> {item.label}
                                </button>
                            ))}
                        </nav>
                        <div className="p-4 border-t border-gray-100"><div className="bg-gray-50 rounded-xl p-4 flex items-center gap-3"><div className="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 font-bold">{currentUser.charAt(0)}</div><div className="overflow-hidden"><p className="text-sm font-bold text-gray-700 truncate">{currentUser}</p><p className="text-xs text-gray-500">{userRole === 'admin' ? 'ผู้ดูแลระบบ' : 'ผู้ใช้งาน'}</p></div></div></div>
                    </aside>
                    <div className="flex-1 flex flex-col h-screen overflow-hidden relative min-w-0">
                        <header className="h-20 bg-white border-b border-gray-200 flex items-center justify-between px-8 sticky top-0 z-10">
                            <div><h2 className="text-2xl font-bold text-gray-800">{getPageTitle()}</h2><p className="text-sm text-gray-500 hidden sm:block">ระบบติดตามงบประมาณ โรงเรียนประจักษ์ศิลปาคม</p></div>
                            <div className="flex items-center gap-4"><button className="p-2 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded-full transition-colors relative"><Icon name="Bell" size={20} /><span className="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border border-white"></span></button><div className="h-8 w-px bg-gray-200 mx-2"></div><button onClick={handleLogout} className="flex items-center gap-2 text-sm font-medium text-gray-500 hover:text-red-600 px-3 py-2 rounded-lg hover:bg-red-50 transition-colors"><Icon name="LogOut" size={18} /><span className="hidden sm:inline">ออกจากระบบ</span></button></div>
                        </header>
                        <main className="flex-1 overflow-y-auto p-4 lg:p-8">{renderContent()}<div className="h-8"></div></main>
                    </div>
                </div>
            );
        };

        // ==========================================
        // 4. APP MOUNTING
        // ==========================================
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>